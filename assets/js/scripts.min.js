/*!
 * Lim9
 * Lim9
 * http://lim9.com
 * @author Lim9
 * @version 1.0.0
 * Copyright 2013. commercial licensed.
 */
(function ($, window, document) {

  'use strict';
  $(function () {

var langfinal;    
    
$.fn.toggleClick = function(){
    var methods = arguments, // store the pa sse   d arguments fo r future reference
        count = methods.length; // cache the number  of methods 

    //use return this to maintain jQuery chainability
    return this.each(function(i, item){
        // for each element you bind to
        var index = 0; // create a local counter for that element
        $(item).click(function(){ // bind a click handler to that element
            return methods[index++ % count].apply(this,arguments); // that whe n  called will apply the 'index'th method to that element
            // the index % count means that we constrain our i terator between 0 and  ( coun t-1)
        });
    });
};



/* --------------------------- ALL VARS ---------------------------*/


var lingua="en";

var chwindow = $(window);
var chabout = $('#about');
var chheader = $('.header');
var chnav = $('.nav');
var chimg1 = $('#imghead');
var chimg2 = $('#imghead2');

 var crtnn = 0;

var stagey = chwindow.height();
var stagex = chwindow.width();

var magi = '';

var is_retina = $('.myowncheck').css('font-family');
var is_mobile;
var is_ortn;
var holdtm;
var imgnmb=1;
var elementkeys=6;



if((navigator.userAgent.toLowerCase().indexOf('android')>=0)==true || (navigator.userAgent.toLowerCase().indexOf('apple-i')>=0)==true || (navigator.userAgent.toLowerCase().indexOf('windows phone')>=0)==true){
  is_mobile = "sim";
  $('.main, .nav').addClass('movel');
}else{
  is_mobile = "nao";
}

if(stagex <= stagey){
  is_ortn = 'portrait';
}else{
  is_ortn = 'landscape';
}


/* --------------------------- Responsive IMAGES ----------------------------*/

function responso(a,b,c){

  if(b !== magi || c==1){



  if (stagex<485)
  {
  a.css('background-image', 'url(/../assets/img/'+b+'-smallest.jpg)');
  }
else if (stagex>485 && stagex<760)
  {
  a.css('background-image', 'url(/../assets/img/'+b+'-small.jpg)');
  }
else if (stagex>760 && stagex<1100)
  {
  a.css('background-image', 'url(/../assets/img/'+b+'-medium.jpg)');
  }
else if (stagex>1100 && stagex<1550)
  {
  a.css('background-image', 'url(/../assets/img/'+b+'-big.jpg)');
  }
else if (stagex>1550)
  {
  a.css('background-image', 'url(/../assets/img/'+b+'-HD.jpg)');
  }
  if(b !== 'Nossa-Foto-Site' && b !== 'nada'){
    magi=b;
  }

}

}





/* ---------------- RESIZE STUFF ------------------- */

/* - INIT SIZE - */

function resizetodo(){

stagey = chwindow.height();
stagex = chwindow.width();




}

resizetodo();

responso(chimg1,'1');
responso(chimg2,'2');

/* - ACTUAL RESIZE - */

$( window ).resize(function() {

resizetodo();

});

function changepic(){
  holdtm = setTimeout(function() {
    chimg1.fadeToggle(1000, setpic());
    chimg2.fadeToggle(1000);
  }, 3000);
}

function setpic(){
    if(chimg1.css('display') == 'none'){
      responso(chimg1, imgnmb+1);
      if(imgnmb<7){
         imgnmb +=1;
       }else{
        imgnmb=0;
       }
     
      changepic();
    }else if(chimg2.css('display') == 'none'){
      responso(chimg2, imgnmb+1);
      if(imgnmb<7){
         imgnmb +=1;
       }else{
        imgnmb=0;
       }
      changepic();
    }
}

changepic();

/* - - - - - - - - - - - - - - NEW SMOOTH SCROLL - - - - - - - - - - - - - - - - */

$(".main").onepage_scroll({
   sectionContainer: "section",     // sectionContainer accepts any kind of selector in case you don't want to use section
   easing: "ease",                  // Easing options accepts the CSS3 easing animation such "ease", "linear", "ease-in", 
                                    // "ease-out", "ease-in-out", or even cubic bezier value such as "cubic-bezier(0.175, 0.885, 0.420, 1.310)"
   animationTime: 1000,             // AnimationTime let you define how long each section takes to animate
   pagination: false,                // You can either show or hide the pagination. Toggle true for show, false for hide.
   updateURL: false,                // Toggle this true if you want the URL to be updated automatically when the user scroll to each page.
   beforeMove: function(index) {
    if(index==1){
      chnav.fadeOut(0);
      changepic();
    }
    if(index==2){
      clearTimeout(holdtm);
    }

     if(index!=6){
      closewho();
    }

   

    if(index!=7){
      closehelp();
    }


   },  // This option accepts a callback function. The function will be called before the page moves.
   afterMove: function(index) {
    if(index==2){
      chnav.fadeIn(0);
      animartnw();

    }
    if(index!=2){
      closetnw();
    }
    if(index==3){
      chnav.fadeIn(0);
      animarwhy();
    }
     if(index!=3){
      closewhy();
    }

      if(index==4){
        chnav.fadeIn(0);
      animarwhat();
    }
     if(index!=4){
      closewhat();
    }

        if(index==5){
          chnav.fadeIn(0);
      animarhow();
    }
     if(index!=5){
      closehow();
    }

    if(index==6){
      
          chnav.fadeIn(0);
      animarwho();
    }

     if(index==7){
      animarhelp();
    }
    



   },   // This option accepts a callback function. The function will be called after the page moves.
   loop: false,                     // You can have the page loop back to the top/bottom when the user navigates at up/down on the first/last page.
   keyboard: true,                  // You can activate the keyboard controls
   responsiveFallback: false        // You can fallback to normal page scroll by defining the width of the browser in which
                                    // you want the responsive fallback to be triggered. For example, set this to 600 and whenever 
                                    // the browser's width is less than 600, the fallback will kick in.
});


   

/* - - - Change Language - - - */



$('#langbt').click(function(e){

    if(lingua=='en'){
      lingua='pt';
    }else if(lingua=='pt'){
      lingua='en';
    }

    e.preventDefault();
    $('.english').toggleClass("escondido");
    $('.portuguese').toggleClass("escondido");

    console.log("language is "+langfinal);
  
});


/* - - - LINKS - - - */


$('.linksbt').click(function(event) {
  var ulnk = $(this).attr('cadenas');

    window.open(ulnk, "_newtab");
});

/* - - - - - - - - HEADER STUFF - - - - - - - - - - - */

$('#vidhdn').click(function(event) {
  $(this).fadeOut().html('');
});




/* - - - - - - - - - - - - - - -  SVG SHIT - - - - - - - - - - - - - - - */




/* - - - TNW SVG - - - */

var snapy = Snap("#svgtnw");

 var diagramgroup;

Snap.load("assets/img/thenewoman.svg", function (f) {

  for (var y = 1; y < 11; y++) {
              var muy = "#LINHA"+y;
              var myu = "#cara"+y;
              f.select(muy).attr({opacity:0});
              f.select(myu).attr({opacity:0});

            };
   
    snapy.append(f);
    
    
});

function closetnw(){
          for (var w = 1; w < 11; w++) {
              var mul = "#LINHA"+w;
              var muc = "#cara"+w;
              diagramgroup.select(mul).attr({opacity:0});
              diagramgroup.select(muc).attr({opacity:0});

            };
}



          function animartnw(){

            var pq = 1;

            diagramgroup = Snap.select("#svgtnw");

            

            function jutsu(){
              setTimeout(xpani(pq), 1000);
            }

            jutsu();
            


            function xpani(zx){
              var zonxl = "#LINHA"+zx;
              var zonxp = "#cara"+zx;
              diagramgroup.select(zonxl).animate({opacity:1}, 150);
              var x = diagramgroup.select(zonxp).getBBox().x,
                offset = x/2 + 25;
                diagramgroup.select(zonxp).attr({
                    transform: "t"+offset+",0s0.5,0.5,0,0"
                });
            
                setTimeout(function() {
                    diagramgroup.select(zonxp).animate({opacity:1,transform:"t0,0s1,1,0,0"}, 150, mina.elastic);
                }, 150);

                setTimeout(function(){
                  if(pq<11){
                    pq+=1;
                  jutsu();
                  }
                  
                }, 300)
            }

          }


/* - - - WHY SVG - - - */     

var total_frames = 120;
var path = new Array();
var length = new Array(); 
        
var snapwhy = Snap("#svgwhy");

Snap.load("assets/img/logo-tracing.svg", function (f) {

  /*for (var y = 1; y < 11; y++) {
              var muy = "#i"+y;
              f.select(muy).attr({opacity:0});
            };*/
   
    snapwhy.append(f);
    closewhy();

    
    
});

function animarwhy(){

var current_frame = 0;


var handle = 0;

var draw = function() {
   var progress = current_frame/total_frames;
   if (progress > 1) {
     window.cancelAnimationFrame(handle);
   } else {
     current_frame++;
     for(var j=0; j<path.length;j++){
       path[j].style.strokeDashoffset = Math.floor(length[j] * (1 - progress));
     }
     handle = window.requestAnimationFrame(draw);
   }
};
draw();

}

function closewhy(){
  for(var w=0; w<4;w++){
  path[w] = document.getElementById('i'+w);
  var l = path[w].getTotalLength();
  length[w] = l;
  path[w].style.strokeDasharray = l + ' ' + l; 
  path[w].style.strokeDashoffset = l;
}
}

/* - - - WHAT SVG - - - */ 


var snapwhat = Snap("#svgwhat");
var demall;

Snap.load("assets/img/letras.svg", function (f) {

  /*for (var y = 1; y < 11; y++) {
              var muy = "#i"+y;
              f.select(muy).attr({opacity:0});
            };*/
   
    snapwhat.append(f);
    closewhat();

    
    
});

function closewhat(){
  
    demall = Snap.select("#svgwhat");
    for (var w = 1; w < 10; w++) {
              var mul = "#letra"+w;
              demall.select(mul).attr({opacity:0,transform:"t0,10s1,1,0,0"});
            };

}

function animarwhat(){
  var ltrstg = 1;

   function putemin(){
    setTimeout(function(){

      var muv = "#letra"+ltrstg;
       
      demall.select(muv).animate({opacity:1,transform:"t0,0s1,1,0,0"}, 250);
      if(ltrstg<10){
        ltrstg +=1;
        putemin();
      }
      

    },100);
   }

   putemin();

    


}

/* - - - HOW SVG - - - */ 

var snaphow = Snap("#svghow");
var demhow;

Snap.load("assets/img/logohow.svg", function (f) {
   
    snaphow.append(f);
    closehow();

    
    
});

function closehow(){
  
    demhow = Snap.select("#svghow");
    for (var w = 1; w < 7; w++) {
              var mul = "#bola"+w;
              demhow.select(mul).attr({opacity:0,transform:"t0,0.5s1.1,1.1,0,0"});
            };

}

function animarhow(){
  var ltrstg = 1;

   function putemin(){
    setTimeout(function(){

      var muv = "#bola"+ltrstg;
       
      demhow.select(muv).animate({opacity:1,transform:"t0,0s1,1,0,0"}, 250);
      if(ltrstg<7){
        ltrstg +=1;
        putemin();
      }
      

    },100);
   }

   putemin();

    


}

/* - - - - - - - - - WHO SVG - - - - - - - - - */

function closewho(){
  
    $('#imgwho').fadeOut(250);

}

function animarwho(){
   
    $('#imgwho').fadeIn(500);

}


/* - - - - - - - - - HELP SVG - - - - - - - - - */

function closehelp(){
  $('.nav').animate({backgroundColor: '#9ae0bc'},500);
    $('.items2, .items2 a, .items').animate({color:'#fff'},500);
    $('#helpsect').animate({backgroundColor: '#fff'},500);
    $('#texthelp').fadeOut(500);
}

function animarhelp(){
    
    $('.nav').animate({backgroundColor: '#fff'},500);
    $('.items2, .items2 a, .items').animate({color:'#6bc295'},500);
    $('#helpsect').animate({backgroundColor: '#9ae0bc'},500);
    $('#texthelp').fadeIn(500);

}


$('#btsign').click(function(event) {
  validateForm();
});

function validateForm()
{
var x = document.getElementById("emailsignup").value;
var atpos=x.indexOf("@");
var dotpos=x.lastIndexOf(".");
if (atpos<1 || dotpos<atpos+2 || dotpos+2>=x.length)
  {
  alert("Not a valid e-mail address");
  }else{
    sendit();
  }
}

function sendit(){
      $.ajax({
          dataType: 'jsonp',
          url: "http://getsimpleform.com/messages/ajax?form_api_token=8f50bc81696a8d7a9db9032e640aa871",
          data: $('#emailsignup').serialize() 
        }).done(function() {
          //callback which can be used to show a thank you message
          //and reset the form
          alert("Thank you, for contacting us");
      });
}



/* - - - SCROLLTO - - - */

    $('#whatbt').click(function(){   
      
        $(".main").moveTo(4);     
      });

    $('#whybt').click(function(){   
      
        $(".main").moveTo(3);     
      });

    $('#tnwbt').click(function(){   
      
        $(".main").moveTo(2);     
      });

    $('#howbt').click(function(){   
      
        $(".main").moveTo(5);     
      });

    $('#whobt').click(function(){   
      
        $(".main").moveTo(6);     
      });

    $('#helpbt').click(function(){   
      
        $(".main").moveTo(7);     
      });


/* - - - - LANGUAGE STUFF - - - - - - */

$('#mueve').click(function(event) {
  event.preventDefault();
  var zbz = $(this).attr("href");
  window.open(zbz, "_self");
});


/* - - - - - - - - - - - - - - - - EXTRAS - - - - - - - - - - - -  - - - - - - - - - */



console.log("retina is "+is_retina);
console.log("mobile is "+is_mobile);
console.log("orientation is "+is_ortn);







    });

})(jQuery, window, document);

'use strict';(function(d){function h(a,b,e){var c="rgb"+(d.support.rgba?"a":"")+"("+parseInt(a[0]+e*(b[0]-a[0]),10)+","+parseInt(a[1]+e*(b[1]-a[1]),10)+","+parseInt(a[2]+e*(b[2]-a[2]),10);d.support.rgba&&(c+=","+(a&&b?parseFloat(a[3]+e*(b[3]-a[3])):1));return c+")"}function f(a){var b;return(b=/#([0-9a-fA-F]{2})([0-9a-fA-F]{2})([0-9a-fA-F]{2})/.exec(a))?[parseInt(b[1],16),parseInt(b[2],16),parseInt(b[3],16),1]:(b=/#([0-9a-fA-F])([0-9a-fA-F])([0-9a-fA-F])/.exec(a))?[17*parseInt(b[1],16),17*parseInt(b[2],
16),17*parseInt(b[3],16),1]:(b=/rgb\(\s*([0-9]{1,3})\s*,\s*([0-9]{1,3})\s*,\s*([0-9]{1,3})\s*\)/.exec(a))?[parseInt(b[1]),parseInt(b[2]),parseInt(b[3]),1]:(b=/rgba\(\s*([0-9]{1,3})\s*,\s*([0-9]{1,3})\s*,\s*([0-9]{1,3})\s*,\s*([0-9\.]*)\s*\)/.exec(a))?[parseInt(b[1],10),parseInt(b[2],10),parseInt(b[3],10),parseFloat(b[4])]:l[a]}d.extend(!0,d,{support:{rgba:function(){var a=d("script:first"),b=a.css("color"),e=!1;if(/^rgba/.test(b))e=!0;else try{e=b!=a.css("color","rgba(0, 0, 0, 0.5)").css("color"),
a.css("color",b)}catch(c){}return e}()}});var k="color backgroundColor borderBottomColor borderLeftColor borderRightColor borderTopColor outlineColor".split(" ");d.each(k,function(a,b){d.Tween.propHooks[b]={get:function(a){return d(a.elem).css(b)},set:function(a){var c=a.elem.style,g=f(d(a.elem).css(b)),m=f(a.end);a.run=function(a){c[b]=h(g,m,a)}}}});d.Tween.propHooks.borderColor={set:function(a){var b=a.elem.style,e=[],c=k.slice(2,6);d.each(c,function(b,c){e[c]=f(d(a.elem).css(c))});var g=f(a.end);
a.run=function(a){d.each(c,function(d,c){b[c]=h(e[c],g,a)})}}};var l={aqua:[0,255,255,1],azure:[240,255,255,1],beige:[245,245,220,1],black:[0,0,0,1],blue:[0,0,255,1],brown:[165,42,42,1],cyan:[0,255,255,1],darkblue:[0,0,139,1],darkcyan:[0,139,139,1],darkgrey:[169,169,169,1],darkgreen:[0,100,0,1],darkkhaki:[189,183,107,1],darkmagenta:[139,0,139,1],darkolivegreen:[85,107,47,1],darkorange:[255,140,0,1],darkorchid:[153,50,204,1],darkred:[139,0,0,1],darksalmon:[233,150,122,1],darkviolet:[148,0,211,1],fuchsia:[255,
0,255,1],gold:[255,215,0,1],green:[0,128,0,1],indigo:[75,0,130,1],khaki:[240,230,140,1],lightblue:[173,216,230,1],lightcyan:[224,255,255,1],lightgreen:[144,238,144,1],lightgrey:[211,211,211,1],lightpink:[255,182,193,1],lightyellow:[255,255,224,1],lime:[0,255,0,1],magenta:[255,0,255,1],maroon:[128,0,0,1],navy:[0,0,128,1],olive:[128,128,0,1],orange:[255,165,0,1],pink:[255,192,203,1],purple:[128,0,128,1],violet:[128,0,128,1],red:[255,0,0,1],silver:[192,192,192,1],white:[255,255,255,1],yellow:[255,255,
0,1],transparent:[255,255,255,0]}})(jQuery);

if (jQuery) (function ($) {

    $.extend($.fn, {
        dropdown: function (method, data) {

            switch (method) {
                case 'show':
                    show(null, $(this));
                    return $(this);
                case 'hide':
                    hide();
                    return $(this);
                case 'attach':
                    return $(this).attr('data-dropdown', data);
                case 'detach':
                    hide();
                    return $(this).removeAttr('data-dropdown');
                case 'disable':
                    return $(this).addClass('dropdown-disabled');
                case 'enable':
                    hide();
                    return $(this).removeClass('dropdown-disabled');
            }

        }
    });

    function show(event, object) {

        var trigger = event ? $(this) : object,
			dropdown = $(trigger.attr('data-dropdown')),
			isOpen = trigger.hasClass('dropdown-open');

        // In some cases we don't want to show it
        if (event) {
            if ($(event.target).hasClass('dropdown-ignore')) return;

            event.preventDefault();
            event.stopPropagation();
        } else {
            if (trigger !== object.target && $(object.target).hasClass('dropdown-ignore')) return;
        }
        hide();

        if (isOpen || trigger.hasClass('dropdown-disabled')) return;

        // Show it
        trigger.addClass('dropdown-open');
        dropdown
			.data('dropdown-trigger', trigger)
			.show();

        // Position it
        position();

        // Trigger the show callback
        dropdown
			.trigger('show', {
				dropdown: dropdown,
				trigger: trigger
			});

    }

    function hide(event) {

        // In some cases we don't hide them
        var targetGroup = event ? $(event.target).parents().addBack() : null;

        // Are we clicking anywhere in a dropdown?
        if (targetGroup && targetGroup.is('.dropdown')) {
            // Is it a dropdown menu?
            if (targetGroup.is('.dropdown-menu')) {
                // Did we click on an option? If so close it.
                if (!targetGroup.is('A')) return;
            } else {
                // Nope, it's a panel. Leave it open.
                return;
            }
        }

        // Hide any dropdown that may be showing
        $(document).find('.dropdown:visible').each(function () {
            var dropdown = $(this);
            dropdown
				.hide()
				.removeData('dropdown-trigger')
				.trigger('hide', { dropdown: dropdown });
        });

        // Remove all dropdown-open classes
        $(document).find('.dropdown-open').removeClass('dropdown-open');

    }

    function position() {

        var dropdown = $('.dropdown:visible').eq(0),
			trigger = dropdown.data('dropdown-trigger'),
			hOffset = trigger ? parseInt(trigger.attr('data-horizontal-offset') || 0, 10) : null,
			vOffset = trigger ? parseInt(trigger.attr('data-vertical-offset') || 0, 10) : null;

        if (dropdown.length === 0 || !trigger) return;

        // Position the dropdown relative-to-parent...
        if (dropdown.hasClass('dropdown-relative')) {
            dropdown.css({
                left: dropdown.hasClass('dropdown-anchor-right') ?
					trigger.position().left - (dropdown.outerWidth(true) - trigger.outerWidth(true)) - parseInt(trigger.css('margin-right'), 10) + hOffset :
					trigger.position().left + parseInt(trigger.css('margin-left'), 10) + hOffset,
                top: trigger.position().top + trigger.outerHeight(true) - parseInt(trigger.css('margin-top'), 10) + vOffset
            });
        } else {
            // ...or relative to document
            dropdown.css({
                left: dropdown.hasClass('dropdown-anchor-right') ?
					trigger.offset().left - (dropdown.outerWidth() - trigger.outerWidth()) + hOffset : trigger.offset().left + hOffset,
                top: trigger.offset().top + trigger.outerHeight() + vOffset
            });
        }
    }

    $(document).on('click.dropdown', '[data-dropdown]', show);
    $(document).on('click.dropdown', hide);
    $(window).on('resize', position);

})(jQuery);
!function($){
  
  var defaults = {
    sectionContainer: "section",
    easing: "ease",
    animationTime: 1000,
    pagination: true,
    updateURL: false,
    keyboard: true,
    beforeMove: null,
    afterMove: null,
    loop: false,
    responsiveFallback: false
	};
	
	/*------------------------------------------------*/
	/*  Credit: Eike Send for the awesome swipe event */    
	/*------------------------------------------------*/
	
	/*$.fn.swipeEvents = function() {
      return this.each(function() {

        var startX,
            startY,
            $this = $(this);

        $this.bind('touchstart', touchstart);

        function touchstart(event) {
          var touches = event.originalEvent.touches;
          if (touches && touches.length) {
            startX = touches[0].pageX;
            startY = touches[0].pageY;
            $this.bind('touchmove', touchmove);
          }
        }

        function touchmove(event) {
          var touches = event.originalEvent.touches;
          if (touches && touches.length) {
            var deltaX = startX - touches[0].pageX;
            var deltaY = startY - touches[0].pageY;

            if (deltaX >= 50) {
              $this.trigger("swipeLeft");
            }
            if (deltaX <= -50) {
              $this.trigger("swipeRight");
            }
            if (deltaY >= 50) {
              $this.trigger("swipeUp");
            }
            if (deltaY <= -50) {
              $this.trigger("swipeDown");
            }
            if (Math.abs(deltaX) >= 50 || Math.abs(deltaY) >= 50) {
              $this.unbind('touchmove', touchmove);
            }
          }
        }

      });
    };*/
	

  $.fn.onepage_scroll = function(options){
    var settings = $.extend({}, defaults, options),
        el = $(this),
        sections = $(settings.sectionContainer)
        total = sections.length,
        status = "off",
        topPos = 0,
        lastAnimation = 0,
        quietPeriod = 500,
        paginationList = "";
    
    $.fn.transformPage = function(settings, pos, index) {
      if (typeof settings.beforeMove == 'function') settings.beforeMove(index);
      $(this).css({
        "-webkit-transform": "translate3d(0, " + pos + "%, 0)", 
        "-webkit-transition": "-webkit-transform " + settings.animationTime + "ms " + settings.easing,
        "-moz-transform": "translate3d(0, " + pos + "%, 0)", 
        "-moz-transition": "-moz-transform " + settings.animationTime + "ms " + settings.easing,
        "-ms-transform": "translate3d(0, " + pos + "%, 0)", 
        "-ms-transition": "-ms-transform " + settings.animationTime + "ms " + settings.easing,
        "transform": "translate3d(0, " + pos + "%, 0)", 
        "transition": "transform " + settings.animationTime + "ms " + settings.easing
      });
      $(this).one('webkitTransitionEnd otransitionend oTransitionEnd msTransitionEnd transitionend', function(e) {
        if (typeof settings.afterMove == 'function') settings.afterMove(index);
      });
    }
    
    $.fn.moveDown = function() {
      var el = $(this)
      index = $(settings.sectionContainer +".active").data("index");
      current = $(settings.sectionContainer + "[data-index='" + index + "']");
      next = $(settings.sectionContainer + "[data-index='" + (index + 1) + "']");
      if(next.length < 1) {
        if (settings.loop == true) {
          pos = 0;
          next = $(settings.sectionContainer + "[data-index='1']");
        } else {
          return
        }
        
      }else {
        pos = (index * 100) * -1;
      }
      if (typeof settings.beforeMove == 'function') settings.beforeMove( next.data("index"));
      current.removeClass("active")
      next.addClass("active");
      if(settings.pagination == true) {
        $(".onepage-pagination li a" + "[data-index='" + index + "']").removeClass("active");
        $(".onepage-pagination li a" + "[data-index='" + next.data("index") + "']").addClass("active");
      }
      
      $("body")[0].className = $("body")[0].className.replace(/\bviewing-page-\d.*?\b/g, '');
      $("body").addClass("viewing-page-"+next.data("index"))
      
      if (history.replaceState && settings.updateURL == true) {
        var href = window.location.href.substr(0,window.location.href.indexOf('#')) + "#" + (index + 1);
        history.pushState( {}, document.title, href );
      }   
      el.transformPage(settings, pos, next.data("index"));
    }
    
    $.fn.moveUp = function() {
      var el = $(this)
      index = $(settings.sectionContainer +".active").data("index");
      current = $(settings.sectionContainer + "[data-index='" + index + "']");
      next = $(settings.sectionContainer + "[data-index='" + (index - 1) + "']");
      
      if(next.length < 1) {
        if (settings.loop == true) {
          pos = ((total - 1) * 100) * -1;
          next = $(settings.sectionContainer + "[data-index='"+total+"']");
        }
        else {
          return
        }
      }else {
        pos = ((next.data("index") - 1) * 100) * -1;
      }
      if (typeof settings.beforeMove == 'function') settings.beforeMove(next.data("index"));
      current.removeClass("active")
      next.addClass("active")
      if(settings.pagination == true) {
        $(".onepage-pagination li a" + "[data-index='" + index + "']").removeClass("active");
        $(".onepage-pagination li a" + "[data-index='" + next.data("index") + "']").addClass("active");
      }
      $("body")[0].className = $("body")[0].className.replace(/\bviewing-page-\d.*?\b/g, '');
      $("body").addClass("viewing-page-"+next.data("index"))
      
      if (history.replaceState && settings.updateURL == true) {
        var href = window.location.href.substr(0,window.location.href.indexOf('#')) + "#" + (index - 1);
        history.pushState( {}, document.title, href );
      }
      el.transformPage(settings, pos, next.data("index"));
    }
    
    $.fn.moveTo = function(page_index) {
      current = $(settings.sectionContainer + ".active")
      next = $(settings.sectionContainer + "[data-index='" + (page_index) + "']");
      if(next.length > 0) {
        if (typeof settings.beforeMove == 'function') settings.beforeMove(next.data("index"));
        current.removeClass("active")
        next.addClass("active")
        $(".onepage-pagination li a" + ".active").removeClass("active");
        $(".onepage-pagination li a" + "[data-index='" + (page_index) + "']").addClass("active");
        $("body")[0].className = $("body")[0].className.replace(/\bviewing-page-\d.*?\b/g, '');
        $("body").addClass("viewing-page-"+next.data("index"))
        
        pos = ((page_index - 1) * 100) * -1;
        
        if (history.replaceState && settings.updateURL == true) {
            var href = window.location.href.substr(0,window.location.href.indexOf('#')) + "#" + (page_index - 1);
            history.pushState( {}, document.title, href );
        }
        el.transformPage(settings, pos, page_index);
      }
    }
    
    function responsive() {
      if ($(window).width() < settings.responsiveFallback) {
        $("body").addClass("disabled-onepage-scroll");
        $(document).unbind('mousewheel DOMMouseScroll');
        el.swipeEvents().unbind("swipeDown swipeUp");
      } else {
        if($("body").hasClass("disabled-onepage-scroll")) {
          $("body").removeClass("disabled-onepage-scroll");
          $("html, body, .wrapper").animate({ scrollTop: 0 }, "fast");
        }
        
        
        /*el.swipeEvents().bind("swipeDown",  function(event){ 
          if (!$("body").hasClass("disabled-onepage-scroll")) event.preventDefault();
          el.moveUp();
        }).bind("swipeUp", function(event){ 
          if (!$("body").hasClass("disabled-onepage-scroll")) event.preventDefault();
          el.moveDown();
        });*/
        
        $(document).bind('mousewheel DOMMouseScroll', function(event) {
          event.preventDefault();
          var delta = event.originalEvent.wheelDelta || -event.originalEvent.detail;
          init_scroll(event, delta);
        });
      }
    }
    
    
    function init_scroll(event, delta) {
        var deltaOfInterest = delta,
            timeNow = new Date().getTime();
        // Cancel scroll if currently animating or within quiet period
        if(timeNow - lastAnimation < quietPeriod + settings.animationTime) {
            event.preventDefault();
            return;
        }

        if (deltaOfInterest < 0) {
          el.moveDown()
        } else {
          el.moveUp()
        }
        lastAnimation = timeNow;
    }
    
    // Prepare everything before binding wheel scroll
    
    el.addClass("onepage-wrapper").css("position","relative");
    $.each( sections, function(i) {
      $(this).addClass("ops-section").attr("data-index", i+1);
      topPos = topPos + 100;
      if(settings.pagination == true) {
        paginationList += "<li><a data-index='"+(i+1)+"' href='#" + (i+1) + "'></a></li>"
      }
    });
    
    /*el.swipeEvents().bind("swipeDown",  function(event){ 
      if (!$("body").hasClass("disabled-onepage-scroll")) event.preventDefault();
      el.moveUp();
    }).bind("swipeUp", function(event){ 
      if (!$("body").hasClass("disabled-onepage-scroll")) event.preventDefault();
      el.moveDown(); 
    });*/
    
    // Create Pagination and Display Them
    if(settings.pagination == true) {
      $("<ul class='onepage-pagination'>" + paginationList + "</ul>").prependTo("body");
      posTop = (el.find(".onepage-pagination").height() / 2) * -1;
      el.find(".onepage-pagination").css("margin-top", posTop);
    }
    
    if(window.location.hash != "" && window.location.hash != "#1") {
      init_index =  window.location.hash.replace("#", "")
      $(settings.sectionContainer + "[data-index='" + init_index + "']").addClass("active")
      $("body").addClass("viewing-page-"+ init_index)
      if(settings.pagination == true) $(".onepage-pagination li a" + "[data-index='" + init_index + "']").addClass("active");
      
      next = $(settings.sectionContainer + "[data-index='" + (init_index) + "']");
      if(next) {
        next.addClass("active")
        if(settings.pagination == true) $(".onepage-pagination li a" + "[data-index='" + (init_index) + "']").addClass("active");
        $("body")[0].className = $("body")[0].className.replace(/\bviewing-page-\d.*?\b/g, '');
        $("body").addClass("viewing-page-"+next.data("index"))
        if (history.replaceState && settings.updateURL == true) {
          var href = window.location.href.substr(0,window.location.href.indexOf('#')) + "#" + (init_index);
          history.pushState( {}, document.title, href );
        }
      }
      pos = ((init_index - 1) * 100) * -1;
      el.transformPage(settings, pos, init_index);
      
    }else{
      $(settings.sectionContainer + "[data-index='1']").addClass("active")
      $("body").addClass("viewing-page-1")
      if(settings.pagination == true) $(".onepage-pagination li a" + "[data-index='1']").addClass("active");
    }
    if(settings.pagination == true)  {
      $(".onepage-pagination li a").click(function (){
        var page_index = $(this).data("index");
        el.moveTo(page_index);
      });
    }
    
    
    $(document).bind('mousewheel DOMMouseScroll', function(event) {
      event.preventDefault();
      var delta = event.originalEvent.wheelDelta || -event.originalEvent.detail;
      if(!$("body").hasClass("disabled-onepage-scroll")) init_scroll(event, delta);
    });
    
    
    if(settings.responsiveFallback != false) {
      $(window).resize(function() {
        responsive();
      });
      
      responsive();
    }
    
    if(settings.keyboard == true) {
      $(document).keydown(function(e) {
        var tag = e.target.tagName.toLowerCase();
        
        if (!$("body").hasClass("disabled-onepage-scroll")) {
          switch(e.which) {
            case 38:
              if (tag != 'input' && tag != 'textarea') el.moveUp()
            break;
            case 40:
              if (tag != 'input' && tag != 'textarea') el.moveDown()
            break;
            default: return;
          }
        }
        
      });
    }
    return false;
  }
  
  
}(window.jQuery);

